% arara: pdflatex: { synctex: yes }
% arara: makeindex: { style: ctuthesis }
% arara: bibtex

% The class takes all the key=value arguments that \ctusetup does,
% and a couple more: draft and oneside
\documentclass[oneside]{ctuthesis}

\ctusetup{
%	preprint = \ctuverlog,
	mainlanguage = english,
	otherlanguages = {czech},
	title-english = {NLP Methods for Automated Fact-Checking},
	xdoctype = D,
	xfaculty = F3,
	department-english = {Department of Computer Science},
	author = {Ing. Herbert Ullrich},
	supervisor = {Ing. Jan Drchal, Ph.D.},
	fieldofstudy-english = {Informatics},
	subfieldofstudy-english = {Natural Language Processing},
	keywords-czech = {Fact-checking, Natural Language Inference, Claim Generation, Transformers, LLMs},
	keywords-english = {Fact-checking, Natural Language Inference, Claim Generation, Transformers, LLMs},
	day = 21,
	month = 8,
	year = 2023,
	pkg-listings = true
%	monochrome = true,
%	layout-short = true,
}

\ctuprocess

\ctutemplateset{maketitle twocolumn default}{
	\begin{twocolumnfrontmatterpage}
		%\ctutemplate{twocolumn.thanks}
		%\ctutemplate{twocolumn.declaration}
		%\ctutemplate{twocolumn.abstract.in.titlelanguage}
		%\ctutemplate{twocolumn.abstract.in.secondlanguage}
		\ctutemplate{twocolumn.tableofcontents}
		\ctutemplate{twocolumn.listoffigures}
	\end{twocolumnfrontmatterpage}
}

% Theorem declarations, this is the reasonable default, anybody can do what they wish.
% If you prefer theorems in italics rather than slanted, use \theoremstyle{plainit}
\theoremstyle{plain}
\newtheorem{theorem}{Theorem}[chapter]
\newtheorem{corollary}[theorem]{Corollary}
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{proposition}[theorem]{Proposition}

\theoremstyle{definition}
\newtheorem{definition}[theorem]{Definition}
\newtheorem{example}[theorem]{Example}
\newtheorem{conjecture}[theorem]{Conjecture}

\theoremstyle{note}
\newtheorem*{remark*}{Remark}
\newtheorem{remark}[theorem]{Remark}

\DeclareMathOperator*{\argmin}{arg\!min}
\DeclareMathOperator*{\argmax}{arg\!max}


% Only for testing purposes
\listfiles
\usepackage[pagewise]{lineno}
\usepackage{lipsum,blindtext}
\usepackage{mathrsfs} % provides \mathscr used in the ridiculous examples
\usepackage{dirtytalk}
\usepackage{graphicx}

% TODO: filter out unnecessary pckgs
%\usepackage[breaklinks=true]{hyperref}
%\usepackage{breakcites}
\usepackage{cite}
%\usepackage{mathtools}
%\usepackage{amsmath}
%\usepackage{amsfonts}
%\usepackage{amssymb}
%\usepackage{algpseudocode}
%\usepackage{algorithm}
\usepackage{xcolor}
\usepackage{xspace}
\usepackage[ruled,lined,linesnumbered, commentsnumbered]{algorithm2e}
%\usepackage{listings}
%\usepackage{caption}
\usepackage{subcaption}
\usepackage{enumerate}
\usepackage{tabularx}
%\usepackage{hyperref}
\usepackage{tablefootnote}
\usepackage{hhline}
\usepackage{multirow}
\usepackage{dcolumn}

\def\"#1{``#1''}
\def\btn#1{{\itembox{\textbf{\textsf{#1}}}}}
\def\db#1{{{\textit{\textsf{#1}}}}}
\def\todo#1{{\textcolor{red}{{\techbf TODO:} {#1}}}}
\def\tnula{\hyperref[t0]{$\textsf{T}_{\textsf{0}}$}}
\def\tjednaa{\hyperref[t1a]{$\textsf{T}_{\textsf{1a}}$}}
\def\tjednab{\hyperref[t1b]{$\textsf{T}_{\textsf{1b}}$}}
\def\tdvaa{\hyperref[t2a]{$\textsf{T}_{\textsf{2a}}$}}
\def\tdvab{\hyperref[t2b]{$\textsf{T}_{\textsf{2b}}$}}
\def\tdva{\hyperref[t2a]{$\textsf{T}_{\textsf{2}}$}}

\newcommand{\train}{\textsf{train}\xspace}
\newcommand{\dev}{\textsf{dev}\xspace}
\newcommand{\test}{\textsf{test}\xspace}

\newcommand{\SUP}{\texttt{SUPPORTS}}
\newcommand{\REF}{\texttt{REFUTES}}
\newcommand{\NEI}{\texttt{NEI}}

\newcommand{\FEVER}{\textsc{FEVER}\xspace}
\newcommand{\FEVERNLI}{\textsc{FEVER-NLI}\xspace}
\newcommand{\Wikipedia}{\textsc{Wikipedia}\xspace}
\newcommand{\MediaWiki}{\textsc{MediaWiki}\xspace}
\newcommand{\FCZ}{\textsc{CsFEVER}\xspace}
\newcommand{\FCZNLI}{\textsc{CsFEVER-NLI}\xspace}
\newcommand{\FEN}{\textsc{EnFEVER}\xspace}
\newcommand{\FDAN}{\textsc{DanFEVER}\xspace}
\newcommand{\CTK}{\textsc{CTKFacts}\xspace}
\newcommand{\CTKNLI}{\textsc{CTKFactsNLI}\xspace}
\newcommand{\Anserini}{\textsc{Anserini}\xspace}
\newcommand{\DrQA}{\textsc{DrQA}\xspace}
\newcommand{\BERT}{\textsc{Bert}\xspace}
\newcommand{\RoBERTa}{\textsc{RoBERTa}\xspace}
\newcommand{\MBERT}{\textsc{M-Bert}\xspace}
\newcommand{\SMBERT}{\textsc{Sentence M-Bert}\xspace}
\newcommand{\ColBERT}{\textsc{ColBert}\xspace}
\newcommand{\SlavicBERT}{\textsc{SlavicBERT}\xspace}
\newcommand{\CZERT}{\textsc{Czert}\xspace}
\newcommand{\RobeCzech}{\textsc{RobeCzech}\xspace}
\newcommand{\XLM}{\textsc{XLM-RoBERTa}\xspace}
\newcommand{\FERNETC}{\textsc{FERNET-C5}\xspace}
\newcommand{\FERNETN}{\textsc{FERNET-News}\xspace}
\newcommand{\XLMSQUAD}{\textsc{XLM-RoBERTa @ SQuAD2}\xspace}
\newcommand{\XLMXNLI}{\textsc{XLM-RoBERTa @ XNLI}\xspace}
%\newcommand{\todo}[1]{{\color{red}\colorbox{yellow}{\textbf{TODO: }}#1}}
\newcommand{\averitec}{AVeriTeC}
\newcommand{\supp}{Supported}
\newcommand{\reff}{Refuted}
\newcommand{\nei}{Not enough evidence}
\newcommand{\conf}{Conflicting evidence/Cherrypicking}

\begin{document}

\maketitle

\input{chapters/1_introduction}
\input{chapters/2_sota}
\input{chapters/3_current_contributions}
\input{chapters/4_dissertation_plan}
%\input{chapters/5_averitec}
\input{chapters/6_fever}

\input{chapters/9_conclusion}

%\bibliographystyle{amsalpha}
\bibliographystyle{apalike}
\bibliography{dissertation}
\appendix
%\input{appendices/translations}
\chapter{Acronyms}
\begin{description}
\item[BERT] Bidirectional Encoder Representations from Transformers
\item[GPT] Generative Pre-trained Transformer 
\item[FEVER] Fact Extraction and Verification -- series of Shared tasks focused on fact-checking
\item[IR] Information Retrieval
\item[SOTA] State of the Art
\item[XSum] Extreme Summarization -- summarizing article into one sentence
\item[NLI] Natural Language Inference
\item[ÄŒTK] Czech Press Agency
\end{description}

\chapter{LLM configuration used in FEVER 8}

\lstset{
    language={},
    basicstyle=\ttfamily\footnotesize\linespread{0.9}, % Smaller font with less spacing
    keywordstyle=\color{blue}\bfseries,
    commentstyle=\color{green!50!black}\itshape,
    stringstyle=\color{orange},
    numberstyle=\tiny\color{gray},
    numbers=none, % Line numbers on the left
    stepnumber=1, % Line numbers for every line
    numbersep=5pt, % Space between line numbers and code
    tabsize=4, % Size of tabs
    showstringspaces=false, % Don't show spaces in strings
    breaklines=true, % Line wrapping
    breakatwhitespace=true,
    frame=lines, % Add a frame around the code
    captionpos=b, % Caption at the 
    breakindent=1em,
}
\begin{figure*}
    \begin{lstlisting}[breaklines=true, language={}, frame=single, caption={System prompt for the LLMs, \averitec{} claim is to be entered into the user prompt. Three dots represent omitted repeating parts of the prompt. Reused and reprinted from~\citealt{ullrich-etal-2024-aic}.}, label={lst:llm_system_prompt}]
You are a professional fact checker, formulate up to 10 questions that cover all the facts needed to validate whether the factual statement (in User message) is true, false, uncertain or a matter of opinion. Each question has one of four answer types: Boolean, Extractive, Abstractive and Unanswerable using the provided sources.
After formulating Your questions and their answers using the provided sources, You evaluate the possible veracity verdicts (Supported claim, Refuted claim, Not enough evidence, or Conflicting evidence/Cherrypicking) given your claim and evidence on a Likert scale (1 - Strongly disagree, 2 - Disagree, 3 - Neutral, 4 - Agree, 5 - Strongly agree). Ultimately, you note the single likeliest veracity verdict according to your best knowledge.
The facts must be coming from these sources, please refer them using assigned IDs:
---
## Source ID: 1 [url]
[context before]
[page content]
[context after]
...

---
## Output formatting
Please, you MUST only print the output in the following output format:
```json
{
 "questions":
     [
         {"question": "<Your first question>", "answer": "<The answer to the Your first question>", "source": "<Single numeric source ID backing the answer for Your first question>", "answer_type":"<The type of first answer>"},
         {"question": "<Your second question>", "answer": "<The answer to the Your second question>", "source": "<Single numeric Source ID backing the answer for Your second question>", "answer_type":"<The type of second answer>"}
     ],
 "claim_veracity": {
     "Supported": "<Likert-scale rating of how much You agree with the 'Supported' veracity classification>",
     "Refuted": "<Likert-scale rating of how much You agree with the 'Refuted' veracity classification>",
     "Not Enough Evidence": "<Likert-scale rating of how much You agree with the 'Not Enough Evidence' veracity classification>",
     "Conflicting Evidence/Cherrypicking": "<Likert-scale rating of how much You agree with the 'Conflicting Evidence/Cherrypicking' veracity classification>"
 },
 "veracity_verdict": "<The suggested veracity classification for the claim>"
}
```
---
## Few-shot learning
You have access to the following few-shot learning examples for questions and answers.:

### Question examples for claim "{example["claim"]}" (verdict {example["gold_label"]})
"question": "{question}", "answer": "{answer}", "answer_type": "{answer_type}"
...
    \end{lstlisting}
\end{figure*}

\lstset{
    language={},
    basicstyle=\ttfamily\footnotesize\linespread{0.9}, % Smaller font with less spacing
    keywordstyle=\color{blue}\bfseries,
    commentstyle=\color{green!50!black}\itshape,
    stringstyle=\color{orange},
    numberstyle=\tiny\color{gray},
    numbers=none, % Line numbers on the left
    stepnumber=1, % Line numbers for every line
    numbersep=5pt, % Space between line numbers and code
    tabsize=4, % Size of tabs
    showstringspaces=false, % Don't show spaces in strings
    breaklines=true, % Line wrapping
    breakatwhitespace=true,
    frame=lines, % Add a frame around the code
    captionpos=b, % Caption at the 
    breakindent=1em,
}
\chapter{Thinking tokens example}
\begin{figure*}
    \label{appendix_sec:think}
    \begin{lstlisting}[breaklines=true, language={}, frame=single, caption={Qwen3 thinking tokens example.}, label={lst:think}]
<think>
Okay, let's tackle this query. The user is claiming that due to Imran Khan's criticism of Macron's comments on Islam, French authorities cancelled the visas of 183 Pakistani citizens and deported 118 from the country. I need to verify this using the provided sources.

First, I'll look through the sources to see if there's any mention of visa cancellations or deportations related to Imran Khan's criticism. 

Looking at Source ID 1, it talks about Imran Khan responding to Macron's remarks and the condemnation of Islamophobic policies, but there's no mention of visa cancellations or deportations. 

Source ID 2 discusses a diplomatic row where Pakistan refused to accept a deportee, Muhammad Mansha, until his credentials were verified. This seems related to a specific case but not the large numbers mentioned in the claim.

Source ID 3 mentions protests in Pakistan against France's republishing of cartoons, but again, no visa or deportation numbers here.

Source ID 4 and 5 discuss diplomatic tensions, but not specific numbers of deportations. Source 5 and 6 from Newscomworld.com talk about fears of deportations of Pakistanis in France but don't mention specific numbers like 183 or 118.
...

None of the sources mention 183 visas cancelled or 118 deported. The closest is Source 2, which mentions one individual, Muhammad Mansha, but that's a single case. The other sources discuss diplomatic tensions, protests, and possible fears of deportations but no actual numbers provided. 

Therefore, the claim about 183 and 118 seems to be unsupported. The answer would be that there's no evidence of such numbers in the sources provided. The veracity verdict would be Refuted, as the sources don't support the specific numbers given.
</think>

```json
{
    "questions": [
        {"question": "Did French authorities cancel visas or deport Pakistani citizens in response to Imran Khan's criticism of Macron's comments on Islam?", "answer": "No specific information about visa cancellations or deportations of 183 Pakistani citizens or 118 deportees is mentioned in the provided sources.", "source": "10", "answer_type": "Boolean"},
        ...
    ],
    "claim_veracity": {
        "Supported": "1",
        "Refuted": "5",
        "Not Enough Evidence": "1",
        "Conflicting Evidence/Cherrypicking": "1"
    },
    "veracity_verdict": "Refuted"
}
```
    \end{lstlisting}
\end{figure*}
\end{document}